<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feeder Button</title>
    <style>
        body {
          display: flex;
          flex-direction: column; /* Stack elements vertically */
          justify-content: center; /* Center horizontally */
          align-items: center; /* Center vertically */
          height: 100vh; /* Full viewport height */
          margin: 0; /* Remove default margin */
        }

        .feeder-button {
          display: flex;
          align-items: center; /* Align text and timer vertically */
          justify-content: center; /* Center text and timer horizontally */
          width: 200px; /* Fixed width to prevent expansion */
          height: 50px; /* Fixed height to prevent expansion */
          padding: 10px;
          background-color: green;
          color: white;
          border: 2px solid black;
          cursor: pointer;
          text-align: center;
          line-height: 30px; /* Center text vertically */
          transition: background-color 0.3s ease;
          user-select: none; /* Prevent text selection */
          position: relative;
          overflow: hidden; /* Ensure timer is visible without expanding button */
          font-size: 1em; /* Adjust font size for readability */
        }

        .feeder-button:hover {
          background-color: darkgreen;
        }

        .feeder-button.red {
          background-color: red;
        }

        .control-buttons {
          display: flex;
          gap: 20px; /* Space between buttons */
          margin-top: 10px; /* Space above control buttons */
        }

        .control-button {
          padding: 8px;
          border: 1px solid black;
          background-color: lightgray;
          color: black;
          cursor: pointer;
          font-size: 0.8em;
          user-select: none;
        }

        .control-button:hover {
          background-color: gray;
        }
    </style>
</head>
<body>

<button id="feederButton" class="feeder-button">Town Feeder</button>

<div class="control-buttons">
    <button id="onButton" class="control-button">On</button>
    <button id="offButton" class="control-button">Off</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";

    // Firebase configuration (replace with your own config)
    const firebaseConfig = {
      apiKey: "AIzaSyAy53-F5QZ5a0f9DW9emesit1KA2T7v7Do",
      authDomain: "testt-b241d.firebaseapp.com",
      projectId: "testt-b241d",
      storageBucket: "testt-b241d.appspot.com",
      messagingSenderId: "288476078303",
      appId: "1:288476078303:android:ff06d4a9d5c432f41ac96a"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const feederButton = document.getElementById('feederButton');
    const onButton = document.getElementById('onButton');
    const offButton = document.getElementById('offButton');

    const saveButtonStatus = async (color) => {
      try {
        await setDoc(doc(db, 'feeder', 'button_status'), {
          button_color: color
        });
        console.log("Button status saved:", { button_color: color });
      } catch (error) {
        console.error("Error saving button status:", error);
      }
    };

    const loadButtonStatus = async () => {
      try {
        const docRef = doc(db, 'feeder', 'button_status');
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const { button_color } = docSnap.data();
          console.log("Loaded button status:", { button_color });
          if (button_color === 'red') {
            feederButton.classList.add('red');
          } else {
            feederButton.classList.remove('red');
          }
        }
      } catch (error) {
        console.error("Error loading button status:", error);
      }
    };

    const handleOn = async () => {
      feederButton.classList.remove('red'); // Indicating "Off" state
      await saveButtonStatus('green'); // Save green status
    };

    const handleOff = async () => {
      feederButton.classList.add('red'); // Indicating "On" state
      await saveButtonStatus('red'); // Save red status
    };

    onButton.addEventListener('click', handleOn);
    offButton.addEventListener('click', handleOff);

    // Load the button status on page load
    loadButtonStatus();
</script>

</body>
</html>
