<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feeder Button</title>
    <style>
        body {
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          height: 100vh;
          margin: 0;
        }

        .main-container {
          margin-top: 0px; /* Adds margin at the top of the content */
        }

        .feeder-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          margin-bottom: 30px;
        }

        .feeder-button {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 200px;
          height: 50px;
          padding: 10px;
          background-color: green;
          color: white;
          border: 2px solid black;
          cursor: pointer;
          text-align: center;
          line-height: 30px;
          transition: background-color 0.3s ease;
          user-select: none;
          position: relative;
          overflow: hidden;
          font-size: 1em;
          margin-bottom: 10px;
        }

        .feeder-button.red {
          background-color: red;
        }

        .control-buttons {
          display: flex;
          gap: 10px;
          justify-content: center;
        }

        .control-button {
          padding: 10px;
          border: 1px solid black;
          background-color: lightgray;
          color: black;
          cursor: pointer;
          font-size: 1em;
          user-select: none;
        }

        .control-button:hover {
          background-color: gray;
        }
    </style>
</head>
<body>

<div class="main-container">

    <!-- Town Feeder Button with On/Off Controls -->
    <div class="feeder-container">
        <button id="feederButton" class="feeder-button">Town</button>
        <div class="control-buttons">
            <button id="feederOnButton" class="control-button">On</button>
            <button id="feederOffButton" class="control-button">Off</button>
        </div>
    </div>

    <!-- Sultanabaad Button with On/Off Controls -->
    <div class="feeder-container">
        <button id="sultanabaadButton" class="feeder-button">Sultanabaad</button>
        <div class="control-buttons">
            <button id="sultanabaadOnButton" class="control-button">On</button>
            <button id="sultanabaadOffButton" class="control-button">Off</button>
        </div>
    </div>

    <!-- New Market Button with On/Off Controls -->
    <div class="feeder-container">
        <button id="newMarketButton" class="feeder-button">New Market</button>
        <div class="control-buttons">
            <button id="newMarketOnButton" class="control-button">On</button>
            <button id="newMarketOffButton" class="control-button">Off</button>
        </div>
    </div>

</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.16.0/firebase-firestore.js";

    // Firebase configuration (replace with your own config)
    const firebaseConfig = {
      apiKey: "AIzaSyAy53-F5QZ5a0f9DW9emesit1KA2T7v7Do",
      authDomain: "testt-b241d.firebaseapp.com",
      projectId: "testt-b241d",
      storageBucket: "testt-b241d.appspot.com",
      messagingSenderId: "288476078303",
      appId: "1:288476078303:android:ff06d4a9d5c432f41ac96a"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Function to handle saving button statuses to Firestore
    const saveButtonStatus = async (field, color) => {
      try {
        await setDoc(doc(db, 'feeder', 'button_status'), {
          [field]: color
        }, { merge: true }); // Merge with existing data
        console.log(`Button status saved for ${field}:`, { button_color: color });
      } catch (error) {
        console.error(`Error saving button status for ${field}:`, error);
      }
    };

    // Function to handle loading button statuses from Firestore
    const loadButtonStatus = async (buttonElement, field) => {
      try {
        const docRef = doc(db, 'feeder', 'button_status');
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
          const data = docSnap.data();
          const buttonColor = data[field];
          console.log(`Loaded button status for ${field}:`, { button_color: buttonColor });
          if (buttonColor === 'red') {
            buttonElement.classList.add('red');
          } else {
            buttonElement.classList.remove('red');
          }
        }
      } catch (error) {
        console.error(`Error loading button status for ${field}:`, error);
      }
    };

    // Town Feeder Button Event Listeners
    const feederButton = document.getElementById('feederButton');
    const feederOnButton = document.getElementById('feederOnButton');
    const feederOffButton = document.getElementById('feederOffButton');

    feederOnButton.addEventListener('click', async () => {
      feederButton.classList.remove('red');
      await saveButtonStatus('button_color', 'green');
    });

    feederOffButton.addEventListener('click', async () => {
      feederButton.classList.add('red');
      await saveButtonStatus('button_color', 'red');
    });

    // Sultanabaad Button Event Listeners
    const sultanabaadButton = document.getElementById('sultanabaadButton');
    const sultanabaadOnButton = document.getElementById('sultanabaadOnButton');
    const sultanabaadOffButton = document.getElementById('sultanabaadOffButton');

    sultanabaadOnButton.addEventListener('click', async () => {
      sultanabaadButton.classList.remove('red');
      await saveButtonStatus('button_color1', 'green');
    });

    sultanabaadOffButton.addEventListener('click', async () => {
      sultanabaadButton.classList.add('red');
      await saveButtonStatus('button_color1', 'red');
    });

    // New Market Button Event Listeners
    const newMarketButton = document.getElementById('newMarketButton');
    const newMarketOnButton = document.getElementById('newMarketOnButton');
    const newMarketOffButton = document.getElementById('newMarketOffButton');

    newMarketOnButton.addEventListener('click', async () => {
      newMarketButton.classList.remove('red');
      await saveButtonStatus('button_color2', 'green');
    });

    newMarketOffButton.addEventListener('click', async () => {
      newMarketButton.classList.add('red');
      await saveButtonStatus('button_color2', 'red');
    });

    // Load the button statuses on page load
    loadButtonStatus(feederButton, 'button_color');
    loadButtonStatus(sultanabaadButton, 'button_color1');
    loadButtonStatus(newMarketButton, 'button_color2');
</script>

</body>
</html>
